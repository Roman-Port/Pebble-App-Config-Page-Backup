<!DOCTYPE html>
<html>
        <head>
                <title>Clipped</title>
                <meta charset='utf-8'>
                <meta name='viewport' content='width=device-width, initial-scale=1'>
                <link rel='stylesheet' href='/www.famillemattern.com/jnm/pebble/jquery.css'>
                <script src='/www.famillemattern.com/jnm/pebble/jquery-1.js'></script>
                <script src='/www.famillemattern.com/jnm/pebble/jquery.js'></script>

                <link rel="stylesheet" type="text/css" href="/www.famillemattern.com/jnm/pebble/spectrum.css">
                <script type='text/javascript' src="/www.famillemattern.com/jnm/pebble/spectrum.js"></script>
                <script type='text/javascript' src="/www.famillemattern.com/jnm/pebble/argsparse.js"></script>

                <style>
                        .ui-header .ui-title { margin-left: 1em; margin-right: 1em; text-overflow: clip; }
                </style>
        </head>
		<body>
<div data-role="page" id="page1">
    <div data-theme="a" data-role="header" data-position="fixed">
        <div class="ui-grid-a">
            <div class="ui-block-a">
                <input id="cancel" type="submit" data-theme="c" data-icon="delete" data-iconpos="left" value="Cancel" data-mini="true">
            </div>
            <div class="ui-block-b">
                <input id="save" type="submit" data-theme="b" data-icon="check" data-iconpos="right" value="Save" data-mini="true">
            </div>
        </div>
    </div>

<script>

  if (typeof (args.colorCapable) == "undefined") {
    args.colorCapable = 0;
  }

  if ((args.colorCapable == "true") || (args.colorCapable == 1)) {
    args.colorCapable = 1;
  } else {
    args.colorCapable = 0;
  }

</script>

    <div data-role="content">
      <div class="ui-grid-a">
        <div class="ui-block-a">

	<div data-role="fieldcontain">
            <label for="showdate">
                Show Date
			</label>
            <select name="showdate" id="showdate" data-theme="" data-role="slider" data-mini="true">
<script>
  if (typeof (args.showdate) == "undefined") {
    args.showdate = 1;
  }

  s = [ "", "" ];
  s[args.showdate] = " selected";

  document.writeln('<option value="0"' + s[0] + '>Off</option><option value="1"' + s[1] + '>On</option>');
</script>
            </select>
        </div>

      </div>
      <div class="ui-block-b">

        <div data-role="fieldcontain">
            <label for="bigminutes">
                Big Digits show Minutes
            </label>
            <select name="bigminutes" id="bigminutes" data-theme="" data-role="slider" data-mini="true">
<script>
  if (typeof (args.bigminutes) == "undefined") {
    args.bigminutes = 0;
  }

  s = [ "", "" ];
  s[args.bigminutes] = " selected";

  document.writeln('<option value="0"' + s[0] + '>Off</option><option value="1"' + s[1] + '>On</option>');
</script>
            </select>
        </div>
      </div>
      <div class="ui-block-a">

        <div data-role="fieldcontain">
          <label for="btalert">
            Bluetooth Alerts
          </label>
          <select name="btalert" id="btalert" data-theme="" data-role="slider" data-mini="true">
            <script>
              if (typeof (args.btalert) == "undefined") {
                args.btalert = 1;
              }

            s = [ "", "" ];
            s[args.btalert] = " selected";

            document.writeln('<option value="0"' + s[0] + '>Off</option><option value="1"' + s[1] + '>On</option>');
              </script>
          </select>
        </div>
      </div>
      <div class="ui-block-b">

<div id="bw">
  <div data-role="fieldcontain">
    <fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
      <legend>Display</legend>
      <script>
        if (typeof (args.negative) == "undefined") {
          args.negative = 0;
        }

      s = [ "", "" ];
      s[args.negative] = " checked";

      document.writeln('<input id="neg1" name="negative" value="0" data-theme="" type="radio"' + s[0] + '><label for="neg1">White on Black</label>');
      document.writeln('<input id="neg2" name="negative" value="1" data-theme="" type="radio"' + s[1] + '><label for="neg2">Black on White</label>');
        </script>
      
      </fieldset></div>
</div>
      </div>

    </div>
	<div id="toggle">
    <div class="ui-grid-a">
      <div class="ui-block-a">

		<div id="dateorder" data-role="fieldcontain">
			<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
				<legend>Date format</legend>
<script>
  if (typeof (args.dateorder) == "undefined") {
    args.dateorder = 1;
  }

  s = [ "", "" ];
  s[args.dateorder] = " checked";

  document.writeln('<input id="format1" name="dateorder" value="0" data-theme="" type="radio"' + s[0] + '><label for="format1">dd mm</label>');
  document.writeln('<input id="format2" name="dateorder" value="1" data-theme="" type="radio"' + s[1] + '><label for="format2">mm dd</label>');
</script>
			</fieldset>
		</div>
      </div>
      <div class="ui-block-b">

        <div data-role="fieldcontain">
            <label for="weekday">
                Show day of week
            </label>
            <select name="weekday" id="weekday" data-theme="" data-role="slider" data-mini="true">
<script>
  if (typeof (args.weekday) == "undefined") {
    args.weekday = 1;
  }

  s = [ "", "" ];
  s[args.weekday] = " selected";

  document.writeln('<option value="0"' + s[0] + '>Off</option><option value="1"' + s[1] + '>On</option>');
</script>
            </select>
        </div>
      </div>
    </div>

		<div data-role="fieldcontain">
			<label for="lang">
				Language
			</label>
			<select id="lang" data-native-menu="true" name="lang" data-mini="true">
<script>
  var langs = [
    [ 8, 'Danish' ],
    [ 0, 'Dutch' ],
    [ 1, 'English' ],
    [ 2, 'French' ],
    [ 3, 'German' ],
    [ 7, 'Italian' ],
		[ 5, 'Portuguese' ],
    [ 4, 'Spanish' ],
    [ 6, 'Swedish' ]
  ];

  if (typeof (args.lang) == "undefined") {
    args.lang = 1;
  }

  var i, c;
  for (i=0; i<langs.length; i++) {
    if (args.lang == langs[i][0]) {
      c = " selected";
    } else {
      c = "";
    }
    document.writeln('<option value="' + langs[i][0] + '" ' + c + '>' + langs[i][1] + '</option>');
  }
</script>
			</select>
		</div>
	</div>


<div id="color">
  <div class="ui-grid-a">
    <div class="ui-block-a">
      <legend>Background</legend>
    </div>
    <div class="ui-block-b">
      <input id="colorpicker0" name="colorpicker0">
    </div>
    <div class="ui-block-a">
      <legend>Big Digits</legend>
    </div>
    <div class="ui-block-b">
      <input id="colorpicker1" name="colorpicker1">
    </div>
    <div class="ui-block-a">
      <legend>Small Digits</legend>
    </div>
    <div class="ui-block-b">
      <input id="colorpicker2" name="colorpicker2">
    </div>
    <div class="ui-block-a">
      <legend>Small Digits Outline</legend>
    </div>
    <div class="ui-block-b">
      <input id="colorpicker3" name="colorpicker3">
    </div>
    <div class="ui-block-a">
      <legend>Date</legend>
    </div>
    <div class="ui-block-b">
      <input id="colorpicker4" name="colorpicker4">
    </div>
    <div class="ui-block-a">
      <input type="text" id="themecode" name="themecode" data-clear-btn="true">
        </div>
    <div class="ui-block-b">
      <input id="parseTheme" type="button" data-theme="a" data-icon="edit" data-iconpos="left" value="Use Code" data-mini="true">
    </div>
  </div>
</div>

	</div>
</div>

<script>
  if (typeof (args.return_to) == "undefined") {
    args.return_to = 'pebblejs://close#';
  }

  var closeURL = args.return_to;

  if (typeof (args.themecode) == "undefined") {
    args.themecode = 'c0fef8c0fd';
  }

  var passedTheme = args.themecode;
  var curColors = [ '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff' ];

  var encodedTheme = "";
  var pebblePalette = [
    [ '000', '005', '00a', '00f', '050', '055', '05a', '05f' ],
    [ '500', '505', '50a', '50f', '550', '555', '55a', '55f' ],
    [ 'a00', 'a05', 'a0a', 'a0f', 'a50', 'a55', 'a5a', 'a5f' ],
    [ 'f00', 'f05', 'f0a', 'f0f', 'f50', 'f55', 'f5a', 'f5f' ],
    [ '0a0', '0a5', '0aa', '0af', '0f0', '0f5', '0fa', '0ff' ],
    [ '5a0', '5a5', '5aa', '5af', '5f0', '5f5', '5fa', '5ff' ],
    [ 'aa0', 'aa5', 'aaa', 'aaf', 'af0', 'af5', 'afa', 'aff' ],
    [ 'fa0', 'fa5', 'faa', 'faf', 'ff0', 'ff5', 'ffa', 'fff' ]
  ];

  function color8to24bit(color8bit) {
   var c = parseInt(color8bit, 16) - 192;
   var r = 0x55 * ((c & 0x30) >> 4);
   var g = 0x55 * ((c & 0xc) >> 2);
   var b = 0x55 * (c & 0x3);
   var rgb = (r << 16) + (g << 8) + (b);
   var result = "#" + ("000000" + rgb.toString(16)).slice(-6);

   return result;
  }

  function charIsValidHexa(c) {
    return ( ( (c >= "0".charCodeAt(0)) && (c <= "9".charCodeAt(0)) ) || ( (c >= "a".charCodeAt(0)) && (c <= "f".charCodeAt(0)) ) );
  }

  function decodeTheme(themeString) {
    var fallbackTheme = "c0fef8c0fd";
    var validCode = true;
    var i = 0;

    themeString = themeString.toLowerCase();

    if (themeString == "undefined") {
      themeString = fallbackTheme;
    }

    var len = themeString.length;
    if (len != 10) {
      alert("Invalid Theme Code: must be 10 characters long.");
      validCode = false;
    }

    invalidChars = false;
    for (i=0; i<len; i++) {
      curChar = themeString.charCodeAt(i);
      if (!charIsValidHexa(themeString.charCodeAt(i))) {
        invalidChars = true;
        break;
      }
    }

    if (invalidChars && validCode) {
      alert("Invalid Theme Code: must only contain chars from 0 to 9 or a to f");
    }

    if (validCode) {
      for (i=0; i<5; i++) {
        curColors[i] = color8to24bit(themeString.substr(2*i, 2));
      }
    }
  }

  function color24to8bit(color) {
    var r = parseInt(color.substr(1, 2), 16) >> 6;
    var g = parseInt(color.substr(3, 2), 16) >> 6;
    var b = parseInt(color.substr(5, 2), 16) >> 6;

    var result = (192+(r*16)+(g*4)+b).toString(16);
    return ("00" + result).slice(-2);
  }

  function encodeColors() {
    var i = 0;
    encodedTheme = "";
    
    for (i=0; i<5; i++) {
      encodedTheme += color24to8bit(curColors[i]);
    }
  }

  function setColors() {
    encodeColors();

    $('#themecode').val(encodedTheme);
  }

  function setColorPickers() {
    var i = 0;

    for (i=0; i<5; i++) {
      $("#colorpicker"+i).spectrum("set", curColors[i]);
    }
  }

  function setColor(i, color) {
    curColors[i] = color.toHexString();
    setColors();
    setColorPickers();
  }


  function saveOptions() {
    var options = {
      'dateorder': parseInt($("input[name=dateorder]:checked").val(), 10),
      'negative': parseInt($("input[name=negative]:checked").val(), 10),
      'weekday': parseInt($("#weekday").val(), 10),
      'bigminutes': parseInt($("#bigminutes").val(), 10),
      'showdate': parseInt($("#showdate").val(), 10),
      'lang': parseInt($("#lang").val(), 10),
      'themecode': $("#themecode").val(),
      'btalert': parseInt($("#btalert").val(), 10)
    }
    return options;
  }

  $().ready(function() {
    decodeTheme(passedTheme);

    if (args.colorCapable == 1) {
      $('div#bw').prop("hidden", true);
    } else {
      $('div#color').prop("hidden", true);
    }

    $('#showdate').change(function() {
      if ($('#showdate').val() == '1') {
        $('div#toggle').prop("hidden", false);
      } else {
        $('div#toggle').prop("hidden", true);
      }
    });

    $("#colorpicker0").spectrum({
        color: curColors[0],
        showPaletteOnly: true,
        hideAfterPaletteSelect:true,
        change: function(color) {
          setColor(0, color);
        },
        palette: pebblePalette
    });

    $("#colorpicker1").spectrum({
        color: curColors[1],
        showPaletteOnly: true,
        hideAfterPaletteSelect:true,
        change: function(color) {
          setColor(1, color);
        },
        palette: pebblePalette
    });

    $("#colorpicker2").spectrum({
        color: curColors[2],
        showPaletteOnly: true,
        hideAfterPaletteSelect:true,
        change: function(color) {
          setColor(2, color);
        },
        palette: pebblePalette
    });

    $("#colorpicker3").spectrum({
        color: curColors[3],
        showPaletteOnly: true,
        hideAfterPaletteSelect:true,
        change: function(color) {
          setColor(3, color);
        },
        palette: pebblePalette
    });

    $("#colorpicker4").spectrum({
        color: curColors[4],
        showPaletteOnly: true,
        hideAfterPaletteSelect:true,
        change: function(color) {
          setColor(4, color);
        },
        palette: pebblePalette
    });

    $("#cancel").click(function() {
      console.log("Cancel");
      document.location = closeURL;
    });

    $("#save").click(function() {
      console.log("Submit");

      var location = closeURL + encodeURIComponent(JSON.stringify(saveOptions()));
      console.log("Close: " + location);
      console.log(location);
      document.location = location;
    });

    $("#parseTheme").click(function() {
      decodeTheme($("#themecode").val());
      setColors();
      setColorPickers();
    });

    $('.sp-replacer').unwrap();

    setColors();

  });
</script>
</body>
</html>
